<template><div><p><img src="@source/docs/Tech/2024-03-22-Flutterreal-timelocationappusingfirebaseandgooglemap/img/Flutter-real-time-location-app-using-firebase-and-google-map_0.png" alt="Flutter Real-Time Location App Using Firebase and Google Map"></p>
<p>ëª¨ë°”ì¼ ì•± ê°œë°œì˜ ë™ì í•œ í’ê²½ ì†ì—ì„œ ì‹¤ì‹œê°„ ìœ„ì¹˜ ì¶”ì  ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“œëŠ” ê²ƒì´ ì ì  ë” ì¤‘ìš”í•´ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì‹¤ì‹œê°„ ìœ„ì¹˜ë¥¼ ì¹œêµ¬ë“¤ê³¼ ê³µìœ í•˜ê±°ë‚˜ ë°°ë‹¬ ì„œë¹„ìŠ¤ë¥¼ ì¶”ì í•˜ê±°ë‚˜ ë‹¤ì–‘í•œ ì‚°ì—… ë¶„ì•¼ì—ì„œ ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚¤ëŠ” ë“±, ì‹¤ì‹œê°„ ìœ„ì¹˜ë¥¼ ì¶”ì í•˜ëŠ” ì•±ì— ëŒ€í•œ ìˆ˜ìš”ê°€ ê³„ì†í•´ì„œ ì¦ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ ê¸°ì‚¬ì—ì„œëŠ” Flutter, Firebase ë° Google Mapsì˜ í˜ì„ ì´ìš©í•˜ì—¬ ê°•ë ¥í•œ ì‹¤ì‹œê°„ ìœ„ì¹˜ ì•±ì„ ê°œë°œí•˜ëŠ” í¥ë¯¸ë¡œìš´ ì—¬ì •ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<h1 id="á„Œá…®á†«á„‡á…µá„†á…®á†¯" tabindex="-1"><a class="header-anchor" href="#á„Œá…®á†«á„‡á…µá„†á…®á†¯" aria-hidden="true">#</a> ì¤€ë¹„ë¬¼</h1>
<p>ë³¸ ê¸°ì‚¬ì—ì„œëŠ” Firebase í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê±°ë‚˜ Google API í‚¤ë¥¼ ì–»ëŠ” ê³¼ì •ì— ëŒ€í•´ ë‹¤ë£¨ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë¯¸ í•´ë‹¹ ë‹¨ê³„ì— ìµìˆ™í•˜ë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤ ğŸ¤. ìµìˆ™í•˜ì§€ ì•Šë‹¤ë©´, ì´ì „ ê¸°ì‚¬ì—ì„œ Firebaseì— ëŒ€í•´ ë‹¤ë£¬ ì ì´ ìˆê³  Google API í‚¤ë¥¼ ì–»ëŠ” ë°©ë²•ì€ ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•©ì‹œë‹¤ ğŸ¤¸â€â™‚ï¸:</p>
<!-- ui-log ìˆ˜í‰í˜• -->
<p><ins class="adsbygoogle"
      style="display:block"
      data-ad-client="ca-pub-4877378276818686"
      data-ad-slot="9743150776"
      data-ad-format="auto"
      data-full-width-responsive="true"></ins></p>
<component is="script">
(adsbygoogle = window.adsbygoogle || []).push({});
</component>
<h1 id="_1-á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³-á„‰á…¥á†¯á„Œá…¥á†¼" tabindex="-1"><a class="header-anchor" href="#_1-á„‘á…³á„…á…©á„Œá…¦á†¨á„á…³-á„‰á…¥á†¯á„Œá…¥á†¼" aria-hidden="true">#</a> 1. í”„ë¡œì íŠ¸ ì„¤ì • :</h1>
<p>ìƒˆë¡œìš´ Flutter í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•´ë³´ì„¸ìš”:</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code>flutter create location_streamer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ì´ì œ ì•±ì— í•„ìš”í•œ ì¢…ì†ì„±ì„ í†µí•©í•´ë´…ì‹œë‹¤:</p>
<!-- ui-log ìˆ˜í‰í˜• -->
<p><ins class="adsbygoogle"
      style="display:block"
      data-ad-client="ca-pub-4877378276818686"
      data-ad-slot="9743150776"
      data-ad-format="auto"
      data-full-width-responsive="true"></ins></p>
<component is="script">
(adsbygoogle = window.adsbygoogle || []).push({});
</component>
<ul>
<li>google_maps_flutter: êµ¬ê¸€ ë§µ í†µí•©ì„ ìœ„í•´.</li>
<li>geolocator: ì‚¬ìš©ìì˜ ì‹¤ì‹œê°„ ìœ„ì¹˜ë¥¼ ì–»ê¸° ìœ„í•´.</li>
<li>firebase_core ë° cloud_firestore: Firebaseë¥¼ ì‚¬ìš©í•œ ì‹¤ì‹œê°„ ë°ì´í„°ë² ì´ìŠ¤ ê¸°ëŠ¥ì„ ìœ„í•´.</li>
<li>permission_handler: ì•±ì—ì„œ í•„ìš”í•œ ê¶Œí•œì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´.</li>
</ul>
<p>pubspec.yaml íŒŒì¼ì„ ì—´ê³  ë‹¤ìŒ ë¼ì¸ì„ ì¶”ê°€í•˜ì„¸ìš”:</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token literal-property property">dependencies</span><span class="token operator">:</span>
  <span class="token literal-property property">google_maps_flutter</span><span class="token operator">:</span> <span class="token operator">^</span><span class="token operator">&lt;</span>latest_version<span class="token operator">></span>
  <span class="token literal-property property">geolocator</span><span class="token operator">:</span> <span class="token operator">^</span><span class="token operator">&lt;</span>latest_version<span class="token operator">></span>
  <span class="token literal-property property">firebase_core</span><span class="token operator">:</span> <span class="token operator">^</span><span class="token operator">&lt;</span>latest_version<span class="token operator">></span>
  <span class="token literal-property property">cloud_firestore</span><span class="token operator">:</span> <span class="token operator">^</span><span class="token operator">&lt;</span>latest_version<span class="token operator">></span>
  <span class="token literal-property property">permission_handler</span><span class="token operator">:</span> <span class="token operator">^</span><span class="token operator">&lt;</span>latest_version<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-1-á„€á…®á„€á…³á†¯-á„†á…¢á†¸-á„€á…®á„‰á…¥á†¼á„’á…¡á„€á…µ" tabindex="-1"><a class="header-anchor" href="#_1-1-á„€á…®á„€á…³á†¯-á„†á…¢á†¸-á„€á…®á„‰á…¥á†¼á„’á…¡á„€á…µ" aria-hidden="true">#</a> 1.1 êµ¬ê¸€ ë§µ êµ¬ì„±í•˜ê¸°:</h2>
<!-- ui-log ìˆ˜í‰í˜• -->
<p><ins class="adsbygoogle"
      style="display:block"
      data-ad-client="ca-pub-4877378276818686"
      data-ad-slot="9743150776"
      data-ad-format="auto"
      data-full-width-responsive="true"></ins></p>
<component is="script">
(adsbygoogle = window.adsbygoogle || []).push({});
</component>
<p>í”ŒëŸ¬í„° í”„ë¡œì íŠ¸ë¥¼ ì„¤ì •í•˜ê³  í•„ìš”í•œ ì¢…ì† í•­ëª©ì„ ì„¤ì¹˜í•œ í›„ì—ëŠ” Google Mapsë¥¼ í†µí•©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ì„¤ëª…ì„œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”. ì¶”ê°€ë¡œ AndroidManifest.xml íŒŒì¼ì— ë‹¤ìŒ ê¶Œí•œì„ í¬í•¨í•˜ì‹­ì‹œì˜¤:</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code>    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì¸í„°ë„·ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ê²ƒì„ í—ˆìš©í•©ë‹ˆë‹¤ <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>uses<span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.INTERNET"</span> <span class="token operator">/</span><span class="token operator">></span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í¬ê·¸ë¼ìš´ë“œ ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ í—ˆìš©í•©ë‹ˆë‹¤ <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>uses<span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.FOREGROUND_SERVICE"</span> <span class="token operator">/</span><span class="token operator">></span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token constant">GPS</span>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •í™•í•œ ìœ„ì¹˜ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ê²ƒì„ í—ˆìš©í•©ë‹ˆë‹¤ <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>uses<span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.ACCESS_FINE_LOCATION"</span> <span class="token operator">/</span><span class="token operator">></span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ëŒ€ëµì ì¸ ìœ„ì¹˜ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ê²ƒì„ í—ˆìš©í•©ë‹ˆë‹¤ <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>uses<span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.ACCESS_COARSE_LOCATION"</span> <span class="token operator">/</span><span class="token operator">></span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìœ„ì¹˜ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ê²ƒì„ í—ˆìš©í•©ë‹ˆë‹¤ <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>uses<span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.ACCESS_BACKGROUND_LOCATION"</span> <span class="token operator">/</span><span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-2-firestore-á„ƒá…¦á„‹á…µá„á…¥á„‡á…¦á„‹á…µá„‰á…³-á„€á…®á„‰á…¥á†¼" tabindex="-1"><a class="header-anchor" href="#_1-2-firestore-á„ƒá…¦á„‹á…µá„á…¥á„‡á…¦á„‹á…µá„‰á…³-á„€á…®á„‰á…¥á†¼" aria-hidden="true">#</a> 1.2 Firestore ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì„±:</h2>
<ul>
<li>Firebase ì½˜ì†”ë¡œ ì´ë™í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ê±°ë‚˜ í•„ìš”í•œ ê²½ìš° ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li>
<li>í”„ë¡œì íŠ¸ ë‚´ì—ì„œ ë°ì´í„°ë¥¼ ì €ì¥í•  Firestore ì¸ìŠ¤í„´ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ìƒì„±í•©ë‹ˆë‹¤.</li>
<li>google-services.json íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ Flutter ì•± ë””ë ‰í† ë¦¬, íŠ¹íˆ android/app/ í•˜ìœ„ì— ë°°ì¹˜í•©ë‹ˆë‹¤. ë˜ëŠ” CLI ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ Firebase êµ¬ì„±ì„ Flutter ì•±ê³¼ ë™ê¸°í™”í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</li>
</ul>
<!-- ui-log ìˆ˜í‰í˜• -->
<p><ins class="adsbygoogle"
      style="display:block"
      data-ad-client="ca-pub-4877378276818686"
      data-ad-slot="9743150776"
      data-ad-format="auto"
      data-full-width-responsive="true"></ins></p>
<component is="script">
(adsbygoogle = window.adsbygoogle || []).push({});
</component>
<p>Firestoreì—ì„œ &quot;users&quot;ë¼ëŠ” ì»¬ë ‰ì…˜ì„ ë§Œë“¤ê³  ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ì‹­ì‹œì˜¤ :</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Location</span> <span class="token punctuation">{</span>
  final double lat<span class="token punctuation">;</span>
  final double lng<span class="token punctuation">;</span>

  <span class="token function">Location</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>lat<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>lng<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  final String name<span class="token punctuation">;</span>
  final Location location<span class="token punctuation">;</span>
  <span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span>
    required <span class="token keyword">this</span><span class="token punctuation">.</span>location<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ìœ„ì˜ í˜•ì‹ì€ ìœ„ë„ì™€ ê²½ë„ë¥¼ í¬í•¨í•˜ëŠ” Location í´ë˜ìŠ¤ì™€ ì´ë¦„ ë° ìœ„ì¹˜ë¥¼ í¬í•¨í•˜ëŠ” User í´ë˜ìŠ¤ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. Firestoreì˜ ë°ì´í„°ê°€</span>
<span class="token comment">// ì´ êµ¬ì¡°ë¥¼ ë”°ë¥´ë„ë¡í•˜ì—¬ í”ŒëŸ¬í„° ì•±ê³¼ì˜ ì ì ˆí•œ í†µí•©ì„ ë³´ì¥í•˜ì‹­ì‹œì˜¤.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="@source/docs/Tech/2024-03-22-Flutterreal-timelocationappusingfirebaseandgooglemap/img/Flutter-real-time-location-app-using-firebase-and-google-map_1.png" alt="Flutter ì‹¤ì‹œê°„ ìœ„ì¹˜ ì¶”ì  ì•± êµ¬í˜„"></p>
<p>ìœ„ ì¢Œí‘œ ì£¼ë³€ì˜ ìœ„ì¹˜ ê°’ì„ LatLng(-18.9216855, 47.5725194)ë¡œ ì¶”ê°€í•˜ë©´ ë™ì¼í•œ ì¹´ë©”ë¼ ë·°ì—ì„œ ëª¨ë“  ì‚¬ìš©ìë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ ê°€ì§œ ë°ì´í„°ì¼ ë¿ì´ì§€ë§Œ ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì½”ë“œì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
<!-- ui-log ìˆ˜í‰í˜• -->
<p><ins class="adsbygoogle"
      style="display:block"
      data-ad-client="ca-pub-4877378276818686"
      data-ad-slot="9743150776"
      data-ad-format="auto"
      data-full-width-responsive="true"></ins></p>
<component is="script">
(adsbygoogle = window.adsbygoogle || []).push({});
</component>
<h2 id="_1-3-firestore-á„€á…®á„’á…§á†«á„’á…¡á„€á…µ" tabindex="-1"><a class="header-anchor" href="#_1-3-firestore-á„€á…®á„’á…§á†«á„’á…¡á„€á…µ" aria-hidden="true">#</a> 1.3 Firestore êµ¬í˜„í•˜ê¸°</h2>
<p>Firestore ë°ì´í„° ê´€ë¦¬ë¥¼ ìœ„í•œ Firestore ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤. ì—¬ê¸°ì„œëŠ” ì‚¬ìš©ì ìœ„ì¹˜ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë©”ì†Œë“œì™€ Firestore ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ì ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ìŠ¤íŠ¸ë¦¼ ë©”ì†Œë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤.</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">FirestoreService</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> final _firestore <span class="token operator">=</span> FirebaseFirestore<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>

  <span class="token keyword">static</span> Future<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token function">updateUserLocation</span><span class="token punctuation">(</span>String userId<span class="token punctuation">,</span> LatLng location<span class="token punctuation">)</span> async <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string-property property">'location'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">'lat'</span><span class="token operator">:</span> location<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> <span class="token string-property property">'lng'</span><span class="token operator">:</span> location<span class="token punctuation">.</span>longitude<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> on FirebaseException <span class="token function">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'íŒŒì´ì–´ë² ì´ìŠ¤ ì—ëŸ¬ ë°œìƒ $e'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'ì—ëŸ¬ ë°œìƒ $err'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> Stream<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>User<span class="token operator">>></span> <span class="token function">userCollectionStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> _firestore<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">snapshots</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">snapshot</span><span class="token punctuation">)</span> <span class="token operator">=></span>
        snapshot<span class="token punctuation">.</span>docs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=></span> User<span class="token punctuation">.</span><span class="token function">fromMap</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-4-á„Œá…µá„‹á…©á„…á…©á„á…¦á„‹á…µá„‰á…§á†«-á„€á…®á„’á…§á†«á„’á…¡á„€á…µ" tabindex="-1"><a class="header-anchor" href="#_1-4-á„Œá…µá„‹á…©á„…á…©á„á…¦á„‹á…µá„‰á…§á†«-á„€á…®á„’á…§á†«á„’á…¡á„€á…µ" aria-hidden="true">#</a> 1.4 ì§€ì˜¤ë¡œì¼€ì´ì…˜ êµ¬í˜„í•˜ê¸°</h2>
<!-- ui-log ìˆ˜í‰í˜• -->
<p><ins class="adsbygoogle"
      style="display:block"
      data-ad-client="ca-pub-4877378276818686"
      data-ad-slot="9743150776"
      data-ad-format="auto"
      data-full-width-responsive="true"></ins></p>
<component is="script">
(adsbygoogle = window.adsbygoogle || []).push({});
</component>
<p>ì´ì œ ì‚¬ìš©ìì˜ ìœ„ì¹˜ê°€ ë³€ê²½ë  ë•Œ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ìœ„ì¹˜ë¥¼ ì „ì†¡í•´ ë´…ì‹œë‹¤. ì´ë¥¼ ìœ„í•´ geolocator í”ŒëŸ¬ê·¸ì¸ì„ í™œìš©í•  ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì‚¬ìš©ìì˜ ìœ„ì¹˜ì— ì•¡ì„¸ìŠ¤í•˜ê¸° ì „ì—, permission_handlerë¥¼ ì‚¬ìš©í•˜ì—¬ í•„ìš”í•œ ê¶Œí•œì„ ì–»ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">StreamLocationService</span> <span class="token punctuation">{</span>

   <span class="token keyword">static</span> <span class="token keyword">const</span> LocationSettings _locationSettings <span class="token operator">=</span>
       <span class="token function">LocationSettings</span><span class="token punctuation">(</span>distanceFilter<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">static</span> bool _isLocationGranted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

   <span class="token keyword">static</span>  Stream<span class="token operator">&lt;</span>Position<span class="token operator">></span><span class="token operator">?</span> <span class="token keyword">get</span> onLocationChanged  <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>_isLocationGranted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> Geolocator<span class="token punctuation">.</span><span class="token function">getPositionStream</span><span class="token punctuation">(</span>locationSettings<span class="token operator">:</span> _locationSettings<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">static</span> Future<span class="token operator">&lt;</span>bool<span class="token operator">></span> <span class="token function">askLocationPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> async <span class="token punctuation">{</span>
     _isLocationGranted <span class="token operator">=</span> <span class="token keyword">await</span> Permission<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isGranted<span class="token punctuation">;</span>
     <span class="token keyword">return</span> _isLocationGranted<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-5-google-á„Œá…µá„ƒá…©-á„’á…ªá„†á…§á†«á„‹á…¦-á„‰á…µá†¯á„‰á…µá„€á…¡á†«-á„‰á…¡á„‹á…­á†¼á„Œá…¡-á„‹á…±á„á…µ-á„á…®á„€á…¡" tabindex="-1"><a class="header-anchor" href="#_1-5-google-á„Œá…µá„ƒá…©-á„’á…ªá„†á…§á†«á„‹á…¦-á„‰á…µá†¯á„‰á…µá„€á…¡á†«-á„‰á…¡á„‹á…­á†¼á„Œá…¡-á„‹á…±á„á…µ-á„á…®á„€á…¡" aria-hidden="true">#</a> 1.5 Google ì§€ë„ í™”ë©´ì— ì‹¤ì‹œê°„ ì‚¬ìš©ì ìœ„ì¹˜ ì¶”ê°€:</h2>
<ul>
<li>StreamLocationService ë° FirestoreServiceë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì‹œê°„ ì‚¬ìš©ì ì¶”ì ì„ ìœ„í•œ ìœ„ì¹˜ ìŠ¤íŠ¸ë¦¼ ì„¤ì •:</li>
</ul>
<!-- ui-log ìˆ˜í‰í˜• -->
<p><ins class="adsbygoogle"
      style="display:block"
      data-ad-client="ca-pub-4877378276818686"
      data-ad-slot="9743150776"
      data-ad-format="auto"
      data-full-width-responsive="true"></ins></p>
<component is="script">
(adsbygoogle = window.adsbygoogle || []).push({});
</component>
<div class="language-dart ext-dart line-numbers-mode"><pre v-pre class="language-dart"><code>late <span class="token class-name">StreamSubscription</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Position</span><span class="token punctuation">></span></span><span class="token operator">?</span> locationStreamSubscription<span class="token punctuation">;</span>

<span class="token metadata function">@override</span>
<span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  locationStreamSubscription <span class="token operator">=</span>
      <span class="token class-name">StreamLocationService</span><span class="token punctuation">.</span>onLocationChanged<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>position<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token class-name">FirestoreService</span><span class="token punctuation">.</span><span class="token function">updateUserLocation</span><span class="token punctuation">(</span>
        <span class="token string-literal"><span class="token string">'nA7DXYrq1hoKumg3q9fu'</span></span><span class="token punctuation">,</span> <span class="token comment">// í•˜ë“œì½”ë”©ëœ uidì´ì§€ë§Œ, ì¸ì¦ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ë•Œ ì—°ê²°ëœ ì‚¬ìš©ìì˜ uidì…ë‹ˆë‹¤</span>
        <span class="token class-name">LatLng</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> position<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>êµ¬ê¸€ë§µ ìœ„ì ¯ì„ StreamBuilderë¡œ ê°ì‹¸ê³  ìŠ¤íŠ¸ë¦¼ ë°ì´í„°ë¡œ ë§ˆì»¤ë¥¼ ì—…ë°ì´íŠ¸í•˜ì‹­ì‹œì˜¤:</li>
</ul>
<div class="language-dart ext-dart line-numbers-mode"><pre v-pre class="language-dart"><code><span class="token class-name">StreamBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
    stream<span class="token punctuation">:</span> <span class="token class-name">FirestoreService</span><span class="token punctuation">.</span><span class="token function">userCollectionStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
          child<span class="token punctuation">:</span> <span class="token class-name">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Marker</span><span class="token punctuation">></span></span> markers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> user <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        markers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
          <span class="token class-name">Marker</span><span class="token punctuation">(</span>
            markerId<span class="token punctuation">:</span> <span class="token class-name">MarkerId</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">user<span class="token punctuation">.</span>name</span><span class="token punctuation">}</span></span><span class="token string"> position </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">i</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            icon<span class="token punctuation">:</span> user<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string-literal"><span class="token string">'stephano'</span></span>
                <span class="token operator">?</span> <span class="token class-name">BitmapDescriptor</span><span class="token punctuation">.</span><span class="token function">defaultMarkerWithHue</span><span class="token punctuation">(</span>
                    <span class="token class-name">BitmapDescriptor</span><span class="token punctuation">.</span>hueRed<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span>
                <span class="token punctuation">:</span> <span class="token class-name">BitmapDescriptor</span><span class="token punctuation">.</span><span class="token function">defaultMarkerWithHue</span><span class="token punctuation">(</span>
                    <span class="token class-name">BitmapDescriptor</span><span class="token punctuation">.</span>hueYellow<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
            position<span class="token punctuation">:</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>location<span class="token punctuation">.</span>lat<span class="token punctuation">,</span> user<span class="token punctuation">.</span>location<span class="token punctuation">.</span>lng<span class="token punctuation">)</span><span class="token punctuation">,</span>
            onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token class-name">GoogleMap</span><span class="token punctuation">(</span>
        initialCameraPosition<span class="token punctuation">:</span> _initialPosition<span class="token punctuation">,</span>
        markers<span class="token punctuation">:</span> markers<span class="token punctuation">,</span>
        onMapCreated<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">GoogleMapController</span> controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _controller<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ìŠ¤íŠ¸ë¦¼ì„ disposeí•˜ëŠ” ê²ƒì„ ìŠì§€ ë§ˆì„¸ìš”.```</p>
<!-- ui-log ìˆ˜í‰í˜• -->
<p><ins class="adsbygoogle"
      style="display:block"
      data-ad-client="ca-pub-4877378276818686"
      data-ad-slot="9743150776"
      data-ad-format="auto"
      data-full-width-responsive="true"></ins></p>
<component is="script">
(adsbygoogle = window.adsbygoogle || []).push({});
</component>
<p>md
í´ë˜ìŠ¤(MapScreen) êµ¬í˜„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤:</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MapScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">MapScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  @override
  State<span class="token operator">&lt;</span>MapScreen<span class="token operator">></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">MapScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MapScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MapScreen<span class="token operator">></span> <span class="token punctuation">{</span>
  final Completer<span class="token operator">&lt;</span>GoogleMapController<span class="token operator">></span> _controller <span class="token operator">=</span>
      Completer<span class="token operator">&lt;</span>GoogleMapController<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token keyword">const</span> CameraPosition _initialPosition <span class="token operator">=</span> <span class="token function">CameraPosition</span><span class="token punctuation">(</span>
    <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token function">LatLng</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">18.9216855</span><span class="token punctuation">,</span> <span class="token number">47.5725194</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// ì•ˆíƒ€ë‚˜ë‚˜ë¦¬ë³´, ë§ˆë‹¤ê°€ìŠ¤ì¹´ë¥´ LatLng ğŸ‡²ğŸ‡¬</span>
    <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">14.4746</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  late StreamSubscription<span class="token operator">&lt;</span>Position<span class="token operator">></span><span class="token operator">?</span> locationStreamSubscription<span class="token punctuation">;</span>

  @override
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    locationStreamSubscription <span class="token operator">=</span>
        StreamLocationService<span class="token punctuation">.</span>onLocationChanged<span class="token operator">?.</span><span class="token function">listen</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>position<span class="token punctuation">)</span> async <span class="token punctuation">{</span>
        <span class="token keyword">await</span> FirestoreService<span class="token punctuation">.</span><span class="token function">updateUserLocation</span><span class="token punctuation">(</span>
          <span class="token string">'nA7DXYrq1hoKumg3q9fu'</span><span class="token punctuation">,</span> <span class="token comment">//í•˜ë“œì½”ë”©ëœ uidì´ë‚˜ ì´ëŠ” ì¸ì¦ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ë•Œ ì—°ê²°ëœ ì‚¬ìš©ìì˜ uidì…ë‹ˆë‹¤</span>
          <span class="token function">LatLng</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> position<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @override
  Widget <span class="token function">build</span><span class="token punctuation">(</span><span class="token parameter">BuildContext context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> StreamBuilder<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>User<span class="token operator">>></span><span class="token punctuation">(</span>
        <span class="token literal-property property">stream</span><span class="token operator">:</span> FirestoreService<span class="token punctuation">.</span><span class="token function">userCollectionStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">builder</span><span class="token operator">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token function">Center</span><span class="token punctuation">(</span>
              <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          final Set<span class="token operator">&lt;</span>Marker<span class="token operator">></span> markers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            final user <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            markers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
              <span class="token function">Marker</span><span class="token punctuation">(</span>
                <span class="token literal-property property">markerId</span><span class="token operator">:</span> <span class="token function">MarkerId</span><span class="token punctuation">(</span><span class="token string">'${user.name} position $i'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">icon</span><span class="token operator">:</span> user<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'stephano'</span>
                    <span class="token operator">?</span> BitmapDescriptor<span class="token punctuation">.</span><span class="token function">defaultMarkerWithHue</span><span class="token punctuation">(</span>
                        BitmapDescriptor<span class="token punctuation">.</span>hueRed<span class="token punctuation">,</span>
                      <span class="token punctuation">)</span>
                    <span class="token operator">:</span> BitmapDescriptor<span class="token punctuation">.</span><span class="token function">defaultMarkerWithHue</span><span class="token punctuation">(</span>
                        BitmapDescriptor<span class="token punctuation">.</span>hueYellow<span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token function">LatLng</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>location<span class="token punctuation">.</span>lat<span class="token punctuation">,</span> user<span class="token punctuation">.</span>location<span class="token punctuation">.</span>lng<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function-variable function">onTap</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> <span class="token function">GoogleMap</span><span class="token punctuation">(</span>
            <span class="token literal-property property">initialCameraPosition</span><span class="token operator">:</span> _initialPosition<span class="token punctuation">,</span>
            <span class="token literal-property property">markers</span><span class="token operator">:</span> markers<span class="token punctuation">,</span>
            <span class="token literal-property property">onMapCreated</span><span class="token operator">:</span> <span class="token punctuation">(</span>GoogleMapController controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              _controller<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @override
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    locationStreamSubscription<span class="token operator">?.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!-- ui-log ìˆ˜í‰í˜• -->
<p><ins class="adsbygoogle"
      style="display:block"
      data-ad-client="ca-pub-4877378276818686"
      data-ad-slot="9743150776"
      data-ad-format="auto"
      data-full-width-responsive="true"></ins></p>
<component is="script">
(adsbygoogle = window.adsbygoogle || []).push({});
</component>
</div></template>
