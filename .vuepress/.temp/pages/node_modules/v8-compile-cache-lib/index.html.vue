<template><div><h1 id="v8-compile-cache-lib" tabindex="-1"><a class="header-anchor" href="#v8-compile-cache-lib" aria-hidden="true">#</a> v8-compile-cache-lib</h1>
<blockquote>
<p>Fork of <a href="https://www.npmjs.com/package/v8-compile-cache" target="_blank" rel="noopener noreferrer"><code v-pre>v8-compile-cache</code><ExternalLinkIcon/></a> exposed as an API for programmatic usage in other libraries and tools.</p>
</blockquote>
<hr>
<p><a href="https://github.com/cspotcode/v8-compile-cache-lib/actions?query=workflow%3A%22Continuous+Integration%22" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/github/workflow/status/cspotcode/v8-compile-cache-lib/Continuous Integration" alt="Build status"><ExternalLinkIcon/></a></p>
<p><code v-pre>v8-compile-cache-lib</code> attaches a <code v-pre>require</code> hook to use <a href="https://v8project.blogspot.com/2015/07/code-caching.html" target="_blank" rel="noopener noreferrer">V8's code cache<ExternalLinkIcon/></a> to speed up instantiation time. The &quot;code cache&quot; is the work of parsing and compiling done by V8.</p>
<p>The ability to tap into V8 to produce/consume this cache was introduced in <a href="https://nodejs.org/en/blog/release/v5.7.0/" target="_blank" rel="noopener noreferrer">Node v5.7.0<ExternalLinkIcon/></a>.</p>
<h2 id="usage" tabindex="-1"><a class="header-anchor" href="#usage" aria-hidden="true">#</a> Usage</h2>
<ol>
<li>Add the dependency:</li>
</ol>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> --save v8-compile-cache-lib
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2">
<li>Then, in your entry module add:</li>
</ol>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'v8-compile-cache-lib'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong><code v-pre>.install()</code> in Node &lt;5.7.0 is a noop â€“ but you need at least Node 4.0.0 to support the ES2015 syntax used by <code v-pre>v8-compile-cache-lib</code>.</strong></p>
<h2 id="options" tabindex="-1"><a class="header-anchor" href="#options" aria-hidden="true">#</a> Options</h2>
<p>Set the environment variable <code v-pre>DISABLE_V8_COMPILE_CACHE=1</code> to disable the cache.</p>
<p>Cache directory is defined by environment variable <code v-pre>V8_COMPILE_CACHE_CACHE_DIR</code> or defaults to <code v-pre>&lt;os.tmpdir()&gt;/v8-compile-cache-&lt;V8_VERSION&gt;</code>.</p>
<h2 id="internals" tabindex="-1"><a class="header-anchor" href="#internals" aria-hidden="true">#</a> Internals</h2>
<p>Cache files are suffixed <code v-pre>.BLOB</code> and <code v-pre>.MAP</code> corresponding to the entry module that required <code v-pre>v8-compile-cache-lib</code>. The cache is <u>entry module specific</u> because it is faster to load the entire code cache into memory at once, than it is to read it from disk on a file-by-file basis.</p>
<h2 id="benchmarks" tabindex="-1"><a class="header-anchor" href="#benchmarks" aria-hidden="true">#</a> Benchmarks</h2>
<p>See https://github.com/cspotcode/v8-compile-cache-lib/tree/master/bench.</p>
<p><strong>Load Times:</strong></p>
<table>
<thead>
<tr>
<th>Module</th>
<th style="text-align:right">Without Cache</th>
<th style="text-align:right">With Cache</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>babel-core</code></td>
<td style="text-align:right"><code v-pre>218ms</code></td>
<td style="text-align:right"><code v-pre>185ms</code></td>
</tr>
<tr>
<td><code v-pre>yarn</code></td>
<td style="text-align:right"><code v-pre>153ms</code></td>
<td style="text-align:right"><code v-pre>113ms</code></td>
</tr>
<tr>
<td><code v-pre>yarn</code> (bundled)</td>
<td style="text-align:right"><code v-pre>228ms</code></td>
<td style="text-align:right"><code v-pre>105ms</code></td>
</tr>
</tbody>
</table>
<p><u>^ Includes the overhead of loading the cache itself.</u></p>
<h2 id="acknowledgements" tabindex="-1"><a class="header-anchor" href="#acknowledgements" aria-hidden="true">#</a> Acknowledgements</h2>
<ul>
<li>The original <a href="https://github.com/zertosh/v8-compile-cache" target="_blank" rel="noopener noreferrer"><code v-pre>v8-compile-cache</code><ExternalLinkIcon/></a> from which this library is forked.</li>
<li><code v-pre>FileSystemBlobStore</code> and <code v-pre>NativeCompileCache</code> are based on Atom's implementation of their v8 compile cache:
<ul>
<li>https://github.com/atom/atom/blob/b0d7a8a/src/file-system-blob-store.js</li>
<li>https://github.com/atom/atom/blob/b0d7a8a/src/native-compile-cache.js</li>
</ul>
</li>
<li><code v-pre>mkdirpSync</code> is based on:
<ul>
<li>https://github.com/substack/node-mkdirp/blob/f2003bb/index.js#L55-L98</li>
</ul>
</li>
</ul>
</div></template>
